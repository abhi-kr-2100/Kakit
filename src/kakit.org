#+TITLE: Kakit
#+AUTHOR: Abhishek Kumar
#+EMAIL: abhi.kr.2100@gmail.com
#+LANGUAGE: en
#+PROPERTY: header-args :results silent

This file is the entrypoint to the Kakit package.

#+begin_src emacs-lisp :tangle kakit/kakit.el :mkdirp yes
;;; kakit.el --- A Kakoune-inspired editing experience for Emacs -*- lexical-binding: t; -*-

;; Copyright (C) 2025 Abhishek Kumar

;; Author: Abhishek Kumar <abhi.kr.2100@gmail.com>
;; Version: 0.3.0
;; Package-Requires: ((emacs "30.1"))
;; URL: https://github.com/abhi-kr-2100/Kakit

;;; Commentary:

;; Kakit is a Kakoune-inspired editing experience for Emacs.

;;; Code:

(require 'kakit-states)
(require 'kakit-commands-state-switching)
(require 'kakit-keymaps-insert)
(require 'kakit-keymaps-normal)
(require 'kakit-modes-insert)
(require 'kakit-modes-normal)

(defun kakit--init-cleanup-helper ()
  "Turn on Kakit mode and clean up on turn off."
  (if kakit-mode
      (kakit--switch-state-local 'normal)
    (dolist (state-mode kakit--states)
      (let ((state (car state-mode))
            (mode (cdr state-mode)))
        (when (eq state kakit--current-state-local)
          (setq-local kakit--current-state-local nil)
          (funcall mode -1))))))

;;;###autoload
(define-globalized-minor-mode kakit-mode
  kakit-normal-mode
  (lambda () (kakit--switch-state-local 'normal))
  :predicate t
  (kakit--init-cleanup-helper))

(provide 'kakit)

;;; kakit.el ends here
#+end_src
